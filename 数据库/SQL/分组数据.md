# 分组数据

## 数据分组
之前的所有计算都是在表的所有数据或匹配特定的`WHERE`子句的数据上进行，数据分组可以将数据分为多个逻辑组，对每个组进行聚集计算。

## 创建分组

分组是使用`GROUP BY`子句创建的

    SELECT 列名1, COUNT(*) AS 列名2
    FROM 表名
    GROUP BY 列名1;

上面的`GROUP BY`子句指示数据库软件按照`列名1`排序并分组数据，然后对每一个`列名1`计算有多少行作为`列名2`。

`GROUP BY`子句指示数据库软件分组数据，然后对每个组而不是整个结果进行聚集。
- `GROUP BY`子句可以包含任意数量的列，可以对分组进行嵌套；
- 如果在`GROUP BY`子句中嵌套了分组，数据将在最后指定的分组上进行汇总；
- `GROUP BY`子句中列出的每个子句都必须是检索列或者有效的表达式（但不能是聚集函数）。如果在`SELECT`中使用表达式，则必须在`GROUP BY`子句中指定相同的表达式，不能使用别名；
- 如果分组列中包含由`NULL`的行，则`NULL`作为一个分组返回，如果列中有多行`NULL`，它们将分为一组；
- `GROUP BY`子句必须出现在`WHERE`子句之后，`ORDER BY`子句之前。
- `GROUP BY`子句中列出的每一列都必须是检索列或者有效的表达式。

## 过滤分组

使用`GROUP BY`进行分组外，`SQL`还允许过滤分组，规定包括哪些分组，排除哪些分组。`WHERE`过滤行，且`WHERE`过滤是在分组之前进行的。`HAVING`过滤分组，如果不指定`GROUP BY`，则大多数数据库软件会同等对待这两个子句。

过滤`COUNT(*) >= 2`的分组

    SELECT 列名1,COUNT(*) AS 列名2
    FROM 表名
    GROUP BY 列名1
    HAVING COUNT(*) >=2;


## 分组和排序

|分组和排序的区别|说明|
|-|-|
|`ORDER BY`|<li>对产生的输出排序；<li>任意列都可以使用；<li>不一定必须|
|`GROUP BY`|<li>对行进行分组，但是输出可能不是分组的顺序；<li>只可能使用选择列或表达式列，且必须使用每个选择列表达式；<li>如果与聚集函数一起使用列或表达式，则必须使用|

    SELECT 列名1 COUNT(*) AS 列名2
    FROM 表名
    GROUP BY 列名1
    HAVING COUNT(*) >= 3 
    ORDER BY 列名3,列名;


## SELECT子句顺序

|子句|说明|是否必须使用|
|-|-|-|
|`SELECT`|要返回的列或表达式|是|
|`FROM`|从中检索数据的表|仅在从表中选择数据时使用|
|`WHERE`|行级过滤|否|
|`GROUP BY`|分组说明|仅在按组计算聚集时使用|
|`HAVING`|组级过滤|否|
|`ORDER BY`|输出排序顺序|否|