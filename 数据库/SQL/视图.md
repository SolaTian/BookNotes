
# 使用视图

## 视图

> 视图：虚拟的表，只包含使用动态检索数据的查询。

下面这个例子是使用联结从3个表中检索数据。任何需要这个数据的人都必须要了解相关表的结构，知道如何创建查询和对表进行联结。

    SELECT 列名1,列名2
    FROM 表1,表2,表3
    WHERE 表1.列名3 = 表2.列名3
    AND 表3.列名4 = 表2.列名4
    AND 列名5 = 'str1';

将整个查询包装成一个虚拟表。虚拟表就是一个视图，不包含任何列或数据，包含的是一个查询。

    SELECT 列名1,列名2
    FROM 虚拟表
    WHERE 列名5 = 'str1';

### 为什么使用视图

视图的常见应用：
- 重用`SQL`语句；
- 简化复杂的`SQL`操作，编写查询之后，可以方便的重用它而不必知道其基本查询细节；
- 使用表的一部分而不是整个表；
- 保护数据。可以授予用户访问表的特定部分的权限，而不是整个标的访问权限；
- 更改数据格式和表示。视图可以返回与底层表的表示和格式不同的数据。

创建视图之后，可以与普通表基本相同的方式使用它们。可以对视图执行`SELECT`操作，过滤，排序数据，将视图联结到其他的视图或者表，甚至添加和更新数据。


视图仅仅是用来查看存储在别处数据的一种设施。视图本身不包含数据，因此返回的数据是从其他的表中检索出来的。在添加或者更改这些表中的数据时，视图将返回改变过的数据。

### 视图的规则和限制

视图存在一些常见的规则和限制：
- 与表一样，视图必须唯一命名；
- 对于可以创建的视图数目没有限制；
- 创建视图，必须具有足够的访问权限，这些权限通常由数据库管理人员授予；
- 视图可以嵌套，即可以利用从其他视图中检索的数据的查询来构造视图。


## 创建视图

视图使用`CREATE VIEW`语句来创建。与`CREATE TABLE`一样，只能用来创建不存在的视图。删除视图，使用`DROP VIEW`语句。

### 利用视图简化复杂的联结 

最常见的视图应用是隐藏复杂的`SQL`，通常涉及联结。

创建一个视图，该视图联结3个表，

    CREATE VIEW 虚拟表 AS
    SELECT 列名1,列名2,列名3
    FROM 表1,表2,表3
    WHERE 表1.列名4 = 表2.列名4
    AND 表3.列名5 = 表2.列名5

下面的语句表示从视图中检索特定数据

    SELECT 列名1,列名2
    FROM 虚拟表
    WHERE 列名5 = 'str1'


### 使用视图重新格式化检索出来的数据

视图的另一个常见用途是重新格式化检索出来的数据。

下面是一个组合查询的语句。

    SELECT RTRIM(列名1) + '(' + RTRIM(列名2) + ')'
        AS 列名3
    FROM 表1
    ORDER BY 列名1;

如果需要经常使用上面这个格式的结果，可以创建一个视图

    CREATE VIEW 虚拟表 AS
    SELECT RTRIM(列名1) + '(' RTRIM(列名2) + ')'
        AS 列名3
    FROM 表1;

创建完视图之后，若需要检索数据，则使用下列语句

    SELECT * FROM 虚拟表;

### 用视图过滤不想要的数据

视图对于应用普通的`WHERE`子句也很有用。

从表中过滤`列名3`为空的数据

    CREATE VIEW 虚拟表 AS
    SELECT 列名1,列名2,列名3
    FROM 表
    WHERE 列名3 IS NOT NULL;

等同于下面的句子

    SELECT * FROM 虚拟表;

### 使用视图和计算字段

视图也可以用于简化计算字段的使用上。

原语句

    SELECT 列名1,列名2,列名3，列名2*列名3 AS 列名5
    FROM 表
    WHERE 列名6 = 10000;

转换为一个视图

    CREATE VIEW 虚拟表 AS 
    SELECT 列名1,列名2,列名3，列名2*列名3 AS 列名5
    FROM 表
    WHERE 列名6 = 10000;

简化之后的语句

    SELECT * 
    FROM 虚拟表
    WHERE 列名6 = 10000；
